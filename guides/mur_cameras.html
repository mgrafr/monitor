<!DOCTYPE html>
<html class="writer-html5" lang="fr" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>7. MUR de CAMERAS &mdash; Monitor</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="8. MUR de COMMANDES ON/OFF" href="mur_de_commandes.html" />
    <link rel="prev" title="6. GRAHIQUES &amp; BASE DE DONNEES" href="graphiques.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            monitor-domotique
              <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" aria-label="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">SOMMAIRE</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="bien_debuter.html">0. Infos pour bien débuter</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration_minimum.html">1. Configuration minimum : la page d’accueil</a></li>
<li class="toctree-l1"><a class="reference internal" href="plan_interieur.html">2. Une 1ere PAGE : LE PLAN INTERIEUR</a></li>
<li class="toctree-l1"><a class="reference internal" href="meteo.html">3. Météo</a></li>
<li class="toctree-l1"><a class="reference internal" href="plan_exterieur.html">4. La page du plan extérieur</a></li>
<li class="toctree-l1"><a class="reference internal" href="alarme.html">5. L’ALARME</a></li>
<li class="toctree-l1"><a class="reference internal" href="graphiques.html">6. GRAHIQUES &amp; BASE DE DONNEES</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">7. MUR de CAMERAS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#les-pages-index-loc-php-header-php-entete-html-php">7.1- les pages index_loc.php, header.php, entete_html.php</a></li>
<li class="toctree-l2"><a class="reference internal" href="#la-page-de-monitor">7.2- la page de monitor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#les-scripts-js-pour-la-video-dans-footer-php">7.3- Les scripts JS pour la vidéo dans footer.php</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ajouter-une-camera">7.4- Ajouter une caméra</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mur_de_commandes.html">8. MUR de COMMANDES ON/OFF</a></li>
<li class="toctree-l1"><a class="reference internal" href="zigbee.html">9. Dispositifs Zigbee</a></li>
<li class="toctree-l1"><a class="reference internal" href="zwave.html">10. Dispositifs Zwave</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitoring.html">11. MONITORING Nagios</a></li>
<li class="toctree-l1"><a class="reference internal" href="app_diverses.html">12. - FICHIERS LOG Domoticz, Nagios, SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="app_externes.html">13. APPLICATIONS externes en lien avec Domoticz, HA ou monitor</a></li>
<li class="toctree-l1"><a class="reference internal" href="administration.html">14.  ADMINISTRATION</a></li>
<li class="toctree-l1"><a class="reference internal" href="exemples.html">15. EXEMPLES</a></li>
<li class="toctree-l1"><a class="reference internal" href="ajout_page_alertes.html">16. Ajouter des pages ou des alertes</a></li>
<li class="toctree-l1"><a class="reference internal" href="diy.html">17. DIY</a></li>
<li class="toctree-l1"><a class="reference internal" href="divers.html">18. Divers</a></li>
<li class="toctree-l1"><a class="reference internal" href="update.html">19. UPDATE</a></li>
<li class="toctree-l1"><a class="reference internal" href="resolution_problemes.html">20. Résolution de problèmes</a></li>
<li class="toctree-l1"><a class="reference internal" href="mon_installation.html">21. – Mon installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimisations.html">22. OPTIMISATION en cours</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">monitor-domotique</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">7. MUR de CAMERAS</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/guides/mur_cameras.rst.txt" rel="nofollow"> Afficher la source de la page</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="mur-de-cameras">
<h1>7. MUR de CAMERAS<a class="headerlink" href="#mur-de-cameras" title="Lien permanent vers ce titre"></a></h1>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p>Zoneminder doit être installé</p>
</div>
<p>Pour éviter des problèmes de capacité mémoire, vider le cache périodiquement avec CRON :</p>
<p><strong>crontab -e</strong> <a class="reference internal" href="../_images/image555.webp"><img alt="image555" src="../_images/image555.webp" style="width: 332px;" /></a></p>
<p><em>Avec nano ou vim</em> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span> <span class="mi">12</span> <span class="o">*</span> <span class="o">*</span>  <span class="o">*</span> <span class="n">sync</span><span class="p">;</span> <span class="n">echo</span> <span class="mi">3</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">vm</span><span class="o">/</span><span class="n">drop_caches</span>
</pre></div>
</div>
<p><a class="reference internal" href="../_images/image556.webp"><img alt="image556" src="../_images/image556.webp" style="width: 700px;" /></a></p>
<p>Ici la mémoire sera libérée des données cache et tampon tous les jours à 12H ;</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>plus d’ infos</strong> : <a class="reference external" href="https://www.tomzone.fr/vider-la-memoire-cache-dun-serveur-linux/">https://www.tomzone.fr/vider-la-memoire-cache-dun-serveur-linux/</a></p>
</div>
<p><a class="reference internal" href="../_images/image557.webp"><img alt="image557" src="../_images/image557.webp" style="width: 536px;" /></a></p>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p>Il est important d’ajouter les caméras dans Zoneminder les unes après les autres sans en supprimer afin que ces cameras suivent un ordre chronologique (1,2,3,4,5, 6, …)</p>
<p>Voir la page : <a class="reference external" href="http://domo-site.fr/accueil/dossiers/44">http://domo-site.fr/accueil/dossiers/44</a></p>
<p><a class="reference internal" href="../_images/image558.webp"><img alt="image558" src="../_images/image558.webp" style="width: 601px;" /></a></p>
</div>
<div class="section" id="les-pages-index-loc-php-header-php-entete-html-php">
<h2>7.1- les pages index_loc.php, header.php, entete_html.php<a class="headerlink" href="#les-pages-index-loc-php-header-php-entete-html-php" title="Lien permanent vers ce titre"></a></h2>
<ul class="simple">
<li><p><strong>Index_loc.php</strong> , en général, ne pas modifier</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>if (ON_MUR==true) {include (&quot;include/mur_cam.php&quot;);
$_SESSION[&quot;zmuser&quot;]=ZMUSER;$_SESSION[&quot;zmpass&quot;]=ZMPASS;}
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>$_SESSION[« zmuser »] et $_SESSION[« zmpass »], voir les explications ci-après</p>
</div>
<ul class="simple">
<li><p><strong>config.php</strong></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">utilisation</span> <span class="n">du</span> <span class="n">mur</span> <span class="p">:</span><span class="n">true</span> <span class="n">sinon</span> <span class="n">false</span> <span class="p">,</span> <span class="n">Nom</span> <span class="n">du</span> <span class="n">mur</span> <span class="p">,</span> <span class="n">nb</span> <span class="n">caméras</span>
<span class="n">define</span><span class="p">(</span><span class="s1">&#39;ON_MUR&#39;</span><span class="p">,</span><span class="n">true</span><span class="p">);</span><span class="o">//</span> <span class="n">mise</span> <span class="n">en</span> <span class="n">service</span> <span class="n">MUR</span>
<span class="n">define</span><span class="p">(</span><span class="s1">&#39;NOMMUR&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span><span class="o">//</span> <span class="n">nom</span> <span class="n">du</span> <span class="n">mur</span>
<span class="n">define</span><span class="p">(</span><span class="s1">&#39;NBCAM&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">);</span><span class="o">//</span> <span class="n">nombre</span> <span class="n">caméras</span>
<span class="o">//</span> <span class="n">Zoneminder</span>
<span class="n">define</span><span class="p">(</span><span class="s1">&#39;ZMURL&#39;</span><span class="p">,</span><span class="s1">&#39;http://192.168.1.23/zm&#39;</span><span class="p">);</span><span class="o">//</span><span class="n">IP</span><span class="o">/</span><span class="n">zm</span>
<span class="n">define</span><span class="p">(</span><span class="s1">&#39;ZMURLTLS&#39;</span><span class="p">,</span><span class="s1">&#39;https:zoneminder.DOMAINE.ovh&#39;</span><span class="p">);</span><span class="o">//</span> <span class="n">sous</span> <span class="n">domaine</span>
<span class="n">define</span><span class="p">(</span><span class="s1">&#39;ZMUSER&#39;</span><span class="p">,</span><span class="s1">&#39;michel&#39;</span><span class="p">);</span><span class="o">//</span> <span class="n">pour</span> <span class="n">mur_cameras</span><span class="o">.</span><span class="n">php</span>
<span class="n">define</span><span class="p">(</span><span class="s1">&#39;ZMPASS&#39;</span><span class="p">,</span><span class="s1">&#39;MOT_PASSE&#39;</span><span class="p">);</span><span class="o">//</span> <span class="n">pour</span> <span class="n">mur_cameras</span><span class="o">.</span><span class="n">php</span>
<span class="n">define</span><span class="p">(</span><span class="s1">&#39;TIMEAPI&#39;</span><span class="p">,</span><span class="s1">&#39;3400&#39;</span><span class="p">);</span><span class="o">//</span><span class="n">suivant</span> <span class="n">la</span> <span class="n">valeur</span> <span class="n">indiquée</span> <span class="n">dans</span> <span class="n">zoneminder</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>header.php</strong> , il n’y a rien à modifier</p></li>
</ul>
<blockquote>
<div><p><a class="reference internal" href="../_images/image561.webp"><img alt="image561" src="../_images/image561.webp" style="width: 570px;" /></a></p>
</div></blockquote>
<ul class="simple">
<li><p><strong>entete_html.php</strong> , pour le switch ajouter cette ligne</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">link</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;bootstrap/bootstrap-switch-button.css&quot;</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://github.com/gitbrent/bootstrap-switch-button/releases/latest">https://github.com/gitbrent/bootstrap-switch-button/releases/latest</a></p>
</div>
</div>
<div class="section" id="la-page-de-monitor">
<h2>7.2- la page de monitor<a class="headerlink" href="#la-page-de-monitor" title="Lien permanent vers ce titre"></a></h2>
<ul class="simple">
<li><p><strong>mur_cam.php</strong></p></li>
</ul>
<blockquote>
<div><p><a class="reference internal" href="../_images/image563.webp"><img alt="image563" src="../_images/image563.webp" style="width: 608px;" /></a></p>
</div></blockquote>
<ul class="simple">
<li><p><strong>Le script du bouton On/Off</strong> , dans footer , ajouter cette ligne:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">script</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;bootstrap/bootstrap-switch-button.js&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><a class="reference internal" href="../_images/image565.webp"><img alt="image565" src="../_images/image565.webp" style="width: 581px;" /></a></p>
<ul class="simple">
<li><p><strong>mur_cameras.php</strong></p></li>
</ul>
<p><a class="reference internal" href="../_images/image566.webp"><img alt="image566" src="../_images/image566.webp" style="width: 700px;" /></a></p>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p><strong>IMPORTANT</strong> : le fichier include/mur_cameras.php est indépendant du programme (‘est une image en retour) et de ce fait on ne peut utiliser les constantes définies dans admin/config.php</p>
<p>On va donc pour remédier à ce problème :</p>
<ul class="simple">
<li><p>passer l’url en paramètre ainsi que l’Idx</p></li>
<li><p>utiliser les variables de session <span class="red">$_SESSION[« zmuser »] et $_SESSION[« zmpass »] pour le login et le mot de passe</span> car ces données sont sensibles</p></li>
</ul>
</div>
<p><strong>Les fichiers sont tous UTF-8 sans BOM</strong> et l’url des caméras doit se trouver dans <span class="darkblue">mur_cam.php</span>. (<span class="red">ZMURL dans mur_cam.php</span> et non dans mur_cameras.php);</p>
<p>Extrait de mur_cam.php</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?php
$scale=100;$i=1;$j=1;
while ($i &lt;= NBCAM) {
        $camImgId=&quot;cam&quot;.$i;
        if ($j==1) {echo &quot;&lt;tr&gt;&quot;;}
        echo &#39;&lt;td&gt;
        &lt;img id=&quot;&#39;.$camImgId.&#39;&quot; src=&quot;include/mur_cameras.php?idx=&#39;.$i.&#39;&amp;url=&#39;.ZMURL.&#39;&amp;x=&quot; rel=&quot;&#39;.$i.&#39;&quot; class=&quot;dimcam&quot; alt=&quot;&quot;/&gt;&lt;/td&gt;&#39;;
        if (($j==2) || ($i==NBCAM)){ echo &quot;&lt;/tr&gt;&quot;;$j=0;}
  $i++;$j++;}
</pre></div>
</div>
<p><a class="reference internal" href="../_images/image568.webp"><img alt="image568" src="../_images/image568.webp" style="width: 603px;" /></a></p>
</div>
<div class="section" id="les-scripts-js-pour-la-video-dans-footer-php">
<h2>7.3- Les scripts JS pour la vidéo dans footer.php<a class="headerlink" href="#les-scripts-js-pour-la-video-dans-footer-php" title="Lien permanent vers ce titre"></a></h2>
<p>Le Zoom Bootstrap :</p>
<p><a class="reference internal" href="../_images/image569.webp"><img alt="image569" src="../_images/image569.webp" style="width: 602px;" /></a></p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><strong>Rafraichissement des images</strong></p>
<blockquote>
<div><p>Pour limiter l’utilisation de la bande passante, le rafraichissement des images n’a lieu que si le bouton est sur ON ; par contre même sur OFF le zoom d’une caméra est opérationnel
La fonction updateImage() dans footer.php</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">updateImage</span><span class="p">(</span><span class="n">camIndex</span><span class="p">)</span>
<span class="p">{</span><span class="k">if</span> <span class="p">(</span><span class="n">arret_mur</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="n">false</span><span class="p">;</span>
     <span class="o">//</span> <span class="n">get</span> <span class="n">cam</span> <span class="n">image</span> <span class="n">ID</span>
     <span class="n">camImgId</span><span class="o">=</span><span class="s2">&quot;cam&quot;</span> <span class="o">+</span> <span class="n">camIndex</span><span class="p">;</span>

     <span class="o">//</span> <span class="k">if</span> <span class="n">cam</span> <span class="n">image</span> <span class="n">element</span> <span class="ow">is</span> <span class="n">fully</span> <span class="n">downloaded</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="n">camImgId</span><span class="p">)</span><span class="o">.</span><span class="n">complete</span><span class="o">==</span><span class="n">true</span><span class="p">)</span>
     <span class="p">{</span>       <span class="n">now</span><span class="o">=</span><span class="n">new</span> <span class="n">Date</span><span class="p">();</span>
     <span class="o">//</span> <span class="n">update</span> <span class="n">cam</span> <span class="n">index</span> <span class="n">to</span> <span class="nb">next</span> <span class="n">cam</span>
             <span class="n">camIndex</span><span class="o">++</span><span class="p">;</span>
             <span class="k">if</span> <span class="p">(</span><span class="n">camIndex</span> <span class="o">&gt;</span> <span class="n">nbrCam</span><span class="p">)</span> <span class="n">camIndex</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
             <span class="o">//</span> <span class="n">update</span> <span class="nb">next</span> <span class="n">cam</span> <span class="n">URL</span> <span class="n">to</span> <span class="n">force</span> <span class="n">refresh</span>
             <span class="n">camImgId</span><span class="o">=</span><span class="s2">&quot;cam&quot;</span> <span class="o">+</span> <span class="n">camIndex</span><span class="p">;</span>

             <span class="n">camImg</span><span class="o">=</span><span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="n">camImgId</span><span class="p">);</span>
             <span class="n">camImgURL</span><span class="o">=</span><span class="n">camImg</span><span class="o">.</span><span class="n">src</span><span class="p">;</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;gg&#39;</span><span class="o">+</span><span class="n">camImgURL</span><span class="p">);</span>
             <span class="n">camImg</span><span class="o">.</span><span class="n">src</span><span class="o">=</span><span class="n">URL</span><span class="p">[</span><span class="n">camIndex</span><span class="p">]</span><span class="o">+</span><span class="n">now</span><span class="o">.</span><span class="n">getTime</span><span class="p">();</span>
     <span class="p">}</span>

<span class="o">|</span><span class="n">image571</span><span class="o">|</span>
</pre></div>
</div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Les caméras ne sont pas en https, pour éviter les certificats, mais comme l’accès se fait en local (sur le réseau 192.168.1.x) et enregistre une image, sur le serveur, chaque 100ms pour recréer une
vidéo, l’accès distant en https est assuré.</p>
<p><a class="reference internal" href="../_images/image572.webp"><img alt="image572" src="../_images/image572.webp" style="width: 566px;" /></a></p>
</div>
</div>
<div class="section" id="ajouter-une-camera">
<h2>7.4- Ajouter une caméra<a class="headerlink" href="#ajouter-une-camera" title="Lien permanent vers ce titre"></a></h2>
<p>Il suffit d’indiquer dans admin/config.php le nb de caméras</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;NBCAM&#39;</span><span class="p">,</span><span class="s1">&#39;8&#39;</span><span class="p">);</span><span class="o">//</span> <span class="n">nombre</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pied de page">
        <a href="graphiques.html" class="btn btn-neutral float-left" title="6. GRAHIQUES &amp; BASE DE DONNEES" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Précédent</a>
        <a href="mur_de_commandes.html" class="btn btn-neutral float-right" title="8. MUR de COMMANDES ON/OFF" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Gravier.</p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>