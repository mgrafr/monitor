

<!DOCTYPE html>
<html class="writer-html5" lang="fr">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>22. FRIGATE &mdash; Monitor</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=536c50fe" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=d44bf9f9" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=e59be10d"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
      <script src="../_static/translations.js?v=d99ca74e"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="23. OPTIMISATION en cours" href="optimisations.html" />
    <link rel="prev" title="21. – Mon installation" href="mon_installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            monitor-domotique
              <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" aria-label="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">SOMMAIRE</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="bien_debuter.html">0. Infos pour bien débuter</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration_minimum.html">1. Configuration minimum : la page d’accueil</a></li>
<li class="toctree-l1"><a class="reference internal" href="plan_interieur.html">2. Une 1ere PAGE : LE PLAN INTERIEUR</a></li>
<li class="toctree-l1"><a class="reference internal" href="meteo.html">3. Météo</a></li>
<li class="toctree-l1"><a class="reference internal" href="plan_exterieur.html">4. La page du plan extérieur</a></li>
<li class="toctree-l1"><a class="reference internal" href="alarme.html">5. L’ALARME</a></li>
<li class="toctree-l1"><a class="reference internal" href="graphiques.html">6. GRAHIQUES &amp; BASE DE DONNEES</a></li>
<li class="toctree-l1"><a class="reference internal" href="mur_cameras.html">7. MUR de CAMERAS</a></li>
<li class="toctree-l1"><a class="reference internal" href="mur_de_commandes.html">8. MUR de COMMANDES</a></li>
<li class="toctree-l1"><a class="reference internal" href="zigbee.html">9. Dispositifs Zigbee</a></li>
<li class="toctree-l1"><a class="reference internal" href="zwave.html">10. Dispositifs Zwave</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitoring.html">11. MONITORING Nagios</a></li>
<li class="toctree-l1"><a class="reference internal" href="app_diverses.html">12. - FICHIERS LOG Domoticz, Nagios, SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="app_externes.html">13. APPLICATIONS externes en lien avec Domoticz, HA ou monitor</a></li>
<li class="toctree-l1"><a class="reference internal" href="administration.html">14.  ADMINISTRATION</a></li>
<li class="toctree-l1"><a class="reference internal" href="exemples.html">15. EXEMPLES</a></li>
<li class="toctree-l1"><a class="reference internal" href="ajout_page_alertes.html">16. Ajouter des pages ou des alertes</a></li>
<li class="toctree-l1"><a class="reference internal" href="diy.html">17. DIY</a></li>
<li class="toctree-l1"><a class="reference internal" href="divers.html">18. Divers</a></li>
<li class="toctree-l1"><a class="reference internal" href="update.html">19. UPDATE</a></li>
<li class="toctree-l1"><a class="reference internal" href="resolution_problemes.html">20. Résolution de problèmes</a></li>
<li class="toctree-l1"><a class="reference internal" href="mon_installation.html">21. – Mon installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">22. FRIGATE</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#materiel">22.1 Matériel</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installation-du-module-pcie-coral">22.1.1 Installation du module Pcie Coral</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#installation-docker">22.2 Installation docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation-de-frigate">22.3 Installation de Frigate</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creer-le-fichier-de-configuration-docker-compose-yml">22.3.1 Créer le fichier de configuration docker-compose.yml</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configurer-une-camera-config-yml">22.3.2 Configurer une caméra, config.yml</a></li>
<li class="toctree-l3"><a class="reference internal" href="#demarrer-frigate">22.3.3 Démarrer Frigate</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#installer-le-pilote-du-module-coral">22.4 Installer le pilote du module Coral</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installez-le-pilote-pcie-et-les-packages-dexecution-edge-tpu">22.4.1 Installez le pilote PCIe et les packages d’exécution Edge TPU</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#nouvelles-configurations-de-docker-compose-et-config">22.5 nouvelles configurations de docker-compose et config</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#docker-compose-yml">22.5.1 docker-compose.yml</a></li>
<li class="toctree-l3"><a class="reference internal" href="#config-config-yml">22.5.1 config/config.yml</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#installation-de-go2rtc">22.5 installation de go2rtc</a></li>
<li class="toctree-l2"><a class="reference internal" href="#le-fichier-config-config-yml-avec-go2rtc">22.6 le fichier config/config.yml avec go2rtc</a></li>
<li class="toctree-l2"><a class="reference internal" href="#acces-distant">22.7 Accès distant</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-onvif-cameras-ptz">22.8 Configuration onvif (caméras PTZ)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#notifications-sans-homeassistant">22.9 Notifications (sans HomeAssistant)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="optimisations.html">23. OPTIMISATION en cours</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">monitor-domotique</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">22. FRIGATE</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/guides/frigate.rst.txt" rel="nofollow"> Afficher la source de la page</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="frigate">
<h1>22. FRIGATE<a class="headerlink" href="#frigate" title="Lien permanent vers cette rubrique"></a></h1>
<section id="materiel">
<h2>22.1 Matériel<a class="headerlink" href="#materiel" title="Lien permanent vers cette rubrique"></a></h2>
<p>-<strong>1 mini PC</strong>  ou plutôt micro compte tenu de sa taille <em>raccordé au routeur par un cable ethernet</em></p>
<p><a class="reference internal" href="../_images/image1595.webp"><img alt="image1595" src="../_images/image1595.webp" style="width: 400px;" /></a> <a class="reference internal" href="../_images/image1597.webp"><img alt="image1597" src="../_images/image1597.webp" style="width: 250px;" /></a></p>
<ul class="simple">
<li><p>Processeur d’image (GPU):Carte graphique Intel ® Supercore (jusqu’à 750MHz)</p></li>
<li><p>Mémoire en cours d’exécution (RAM):LPDDR5 4800 MT/s, montage à bord,</p></li>
<li><p>Disque dur de stockage:Compatible M.2 2242 SATA, SATA/PCIE</p></li>
<li><p>Construit dans l’expansion de stockage:M.2 2242 peut évoluer à 2 To;</p></li>
<li><p>Sortie graphique:Double sortie HDMI + DP V1.4, prenant en charge une résolution maximale de 4096x2160</p></li>
<li><p>Réseau sans fil:Realtek 8852BE 802.11a/b/g/n/ac/ax</p></li>
<li><p>Interface de puissance:Interface TYPE-C, 12V/3A, 36W (charge uniquement) Prise en charge de l’alimentation PD</p></li>
<li><p>USB-A:USB3.2 (Gen1 * 1) * 3</p></li>
<li><p>Sortie vidéo:HDMI * 2 4096x2160 &#64; 60Hz , DP V1.4 * 1 4096x2160 &#64; 60Hz</p></li>
<li><p>Interface audio:Å3.5mm, CTIA</p></li>
<li><p>Port Ethernet:GLA Lan (RJ45) * 2 1000m/100m/10m</p></li>
<li><p>Indicateur de lumière:Indicateur de puissance bleu clair</p></li>
<li><p>Taille du corps:87*87*39.5MM</p></li>
<li><p>Poids corporel:397 grammes</p></li>
<li><p>Système d’exploitation:Windows 11 Pro Édition Professionnelle</p></li>
</ul>
<section id="installation-du-module-pcie-coral">
<h3>22.1.1 Installation du module Pcie Coral<a class="headerlink" href="#installation-du-module-pcie-coral" title="Lien permanent vers cette rubrique"></a></h3>
<p><a class="reference internal" href="../_images/image1596.webp"><img alt="image1596" src="../_images/image1596.webp" style="width: 200px;" /></a></p>
<p>Comme il n’y a qu’un seul emplacement Pcie occupé par une carte wifi-BT et comme le PC est raccordé par un cable ethernet:</p>
<ul class="simple">
<li><p>on remplace le module wifi (qui se trouve sous la carte M2) par le module Coral</p></li>
</ul>
<p><a class="reference internal" href="../_images/image1598.webp"><img alt="image1598" src="../_images/image1598.webp" style="width: 300px;" /></a></p>
<p>Le couvercle est clipsé, pour l’ouvrir il suffit de déclipser en soulevant avec un tournevis</p>
</section>
</section>
<section id="installation-docker">
<h2>22.2 Installation docker<a class="headerlink" href="#installation-docker" title="Lien permanent vers cette rubrique"></a></h2>
<ul class="simple">
<li><p><strong>Ajouter la clé GPG officielle de Docker:</strong></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">ca</span><span class="o">-</span><span class="n">certificates</span> <span class="n">curl</span>
<span class="n">sudo</span> <span class="n">install</span> <span class="o">-</span><span class="n">m</span> <span class="mi">0755</span> <span class="o">-</span><span class="n">d</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apt</span><span class="o">/</span><span class="n">keyrings</span>
<span class="n">sudo</span> <span class="n">curl</span> <span class="o">-</span><span class="n">fsSL</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">download</span><span class="o">.</span><span class="n">docker</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">debian</span><span class="o">/</span><span class="n">gpg</span> <span class="o">-</span><span class="n">o</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apt</span><span class="o">/</span><span class="n">keyrings</span><span class="o">/</span><span class="n">docker</span><span class="o">.</span><span class="n">asc</span>
<span class="n">sudo</span> <span class="n">chmod</span> <span class="n">a</span><span class="o">+</span><span class="n">r</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apt</span><span class="o">/</span><span class="n">keyrings</span><span class="o">/</span><span class="n">docker</span><span class="o">.</span><span class="n">asc</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Ajoutez le dépôt aux sources Apt :</strong></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> echo \
&quot;deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/debian \
$(. /etc/os-release &amp;&amp; echo &quot;$VERSION_CODENAME&quot;) stable&quot; | \
sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
sudo apt-get update
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Installez les packages Docker:</strong></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">docker</span><span class="o">-</span><span class="n">ce</span> <span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">cli</span> <span class="n">containerd</span><span class="o">.</span><span class="n">io</span> <span class="n">docker</span><span class="o">-</span><span class="n">buildx</span><span class="o">-</span><span class="n">plugin</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">-</span><span class="n">plugin</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>1.  Vérifiez que l’installation a réussi en exécutant l’image :hello-world</strong></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">docker</span> <span class="n">run</span> <span class="n">hello</span><span class="o">-</span><span class="n">world</span>
</pre></div>
</div>
<p><a class="reference internal" href="../_images/image1599.webp"><img alt="image1599" src="../_images/image1599.webp" style="width: 605px;" /></a></p>
<ul class="simple">
<li><p><strong>créer le groupe docker et ajouter-vous comme utilisateur :</strong></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sudo groupadd docker
sudo usermod -aG docker $USER
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Configurer Docker pour qu’il démarre au démarrage avec systemd:</strong></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">docker</span><span class="o">.</span><span class="n">service</span>
<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">containerd</span><span class="o">.</span><span class="n">service</span>
</pre></div>
</div>
<p><a class="reference internal" href="../_images/image1600.webp"><img alt="image1600" src="../_images/image1600.webp" style="width: 605px;" /></a></p>
<ul class="simple">
<li><p><strong>installer Docker-compose:</strong></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">docker</span><span class="o">.</span><span class="n">io</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="o">-</span><span class="n">y</span>
</pre></div>
</div>
</section>
<section id="installation-de-frigate">
<h2>22.3 Installation de Frigate<a class="headerlink" href="#installation-de-frigate" title="Lien permanent vers cette rubrique"></a></h2>
<p><a class="reference external" href="https://github.com/blakeblackshear/frigate">https://github.com/blakeblackshear/frigate</a></p>
<ul class="simple">
<li><p><strong>créer 2 sous-répertoires pour la configuration et la vidéo dans un répertoire « frigate » :</strong></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">opt</span>
<span class="n">mkdir</span> <span class="n">frigate</span> <span class="o">&amp;&amp;</span> <span class="n">cd</span> <span class="n">frigate</span>
<span class="n">mkdir</span> <span class="n">config</span>
<span class="n">mkdir</span> <span class="n">media</span>
</pre></div>
</div>
<p><a class="reference internal" href="../_images/image1601.webp"><img alt="image1601" src="../_images/image1601.webp" style="width: 399px;" /></a></p>
<section id="creer-le-fichier-de-configuration-docker-compose-yml">
<h3>22.3.1 Créer le fichier de configuration docker-compose.yml<a class="headerlink" href="#creer-le-fichier-de-configuration-docker-compose-yml" title="Lien permanent vers cette rubrique"></a></h3>
<p><a class="reference internal" href="../_images/image1602.webp"><img alt="image1602" src="../_images/image1602.webp" style="width: 535px;" /></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">nano</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">version</span><span class="p">:</span> <span class="s2">&quot;3.9&quot;</span>
<span class="n">services</span><span class="p">:</span>
  <span class="n">frigate</span><span class="p">:</span>
    <span class="n">privileged</span><span class="p">:</span> <span class="n">true</span> <span class="c1"># this may not be necessary for all setups</span>
    <span class="n">restart</span><span class="p">:</span> <span class="n">unless</span><span class="o">-</span><span class="n">stopped</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">ghcr</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">blakeblackshear</span><span class="o">/</span><span class="n">frigate</span><span class="p">:</span><span class="n">stable</span>
<span class="c1">#    devices:</span>
<span class="c1">#     - /dev/bus/usb:/dev/bus/usb # Passe l’USB Coral, doit être</span>
                               <span class="c1"># modifié pour d’autres versions</span>
<span class="c1">#     - /dev/apex_0:/dev/apex_0 # Passe un PCIe Coral, suivez les</span>
          <span class="c1"># instructions du pilote ici</span>
          <span class="c1"># https://coral.ai/docs/m2/get-started/#2a-on-linux</span>
    <span class="n">ports</span><span class="p">:</span>
      <span class="o">-</span> <span class="s2">&quot;5000:5000&quot;</span>
      <span class="o">-</span> <span class="s2">&quot;1935:1935&quot;</span>
      <span class="o">-</span> <span class="s2">&quot;554:8554&quot;</span> <span class="c1"># Flux RTSP</span>
    <span class="n">volumes</span><span class="p">:</span>
      <span class="o">-</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">frigate</span><span class="o">/</span><span class="n">config</span><span class="p">:</span><span class="o">/</span><span class="n">config</span>
      <span class="o">-</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">frigate</span><span class="o">/</span><span class="n">media</span><span class="p">:</span><span class="o">/</span><span class="n">media</span>
      <span class="o">-</span> <span class="nb">type</span><span class="p">:</span> <span class="n">tmpfs</span> <span class="c1"># En option:1 Go de memoire,réduit l</span>
                    <span class="c1"># usure de la carte SSD/SD</span>
        <span class="n">target</span><span class="p">:</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">cache</span>
     <span class="n">tmpfs</span><span class="p">:</span>
       <span class="n">size</span><span class="p">:</span> <span class="mi">100000000</span>
    <span class="n">environment</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">FRIGATE_RTSP_PASSWORD</span><span class="o">=&lt;</span><span class="n">PASS</span><span class="o">&gt;</span>
      <span class="o">-</span> <span class="n">FRIGATE_RTSP_USER</span><span class="o">=&lt;</span><span class="n">USER</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="configurer-une-camera-config-yml">
<h3>22.3.2 Configurer une caméra, config.yml<a class="headerlink" href="#configurer-une-camera-config-yml" title="Lien permanent vers cette rubrique"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">nano</span> <span class="n">config</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
<p><a class="reference internal" href="../_images/image1603.webp"><img alt="image1603" src="../_images/image1603.webp" style="width: 505px;" /></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>mqtt:
  enabled: false
cameras:
  jardin_cote_rue:
    ffmpeg:
      inputs:
        - path: rtsp://michel:IdemIdem4546@192.168.1.107:554/cam/realmonitor?channel=1&amp;subtype=0
          roles:
            - record
        - path: rtsp://michel:IdemIdem4546@192.168.1.107:554/cam/realmonitor?channel=1&amp;subtype=0
          roles:
            - detect
    detect:
      enabled: true
version: 0.14
camera_groups:
  cam:
    order: 1
    icon: LuAirplay
    cameras:
      - Jardin_cote_rue
</pre></div>
</div>
</section>
<section id="demarrer-frigate">
<h3>22.3.3 Démarrer Frigate<a class="headerlink" href="#demarrer-frigate" title="Lien permanent vers cette rubrique"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Affichage dans le navigateur</strong></p></li>
</ul>
<p><a class="reference internal" href="../_images/image1604.webp"><img alt="image1604" src="../_images/image1604.webp" style="width: 559px;" /></a></p>
</section>
</section>
<section id="installer-le-pilote-du-module-coral">
<h2>22.4 Installer le pilote du module Coral<a class="headerlink" href="#installer-le-pilote-du-module-coral" title="Lien permanent vers cette rubrique"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">uname</span> <span class="o">-</span><span class="n">r</span>
</pre></div>
</div>
<p><a class="reference internal" href="../_images/image1605.webp"><img alt="image1605" src="../_images/image1605.webp" style="width: 351px;" /></a></p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<ul class="simple">
<li><p>Si la version de votre noyau est 4.19 ou supérieure, vérifier si un pilote Apex pré-construit est installé</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">lsmod</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">apex</span>
</pre></div>
</div>
<p><a class="reference internal" href="../_images/image1606.webp"><img alt="image1606" src="../_images/image1606.webp" style="width: 460px;" /></a></p>
<p>S’il n’affiche rien, tout va bien , continuez à installer le pilote PCIe. Si il affiche un nom de module Apex, suivre la solution pour désactiver Apex et Gasket: <a class="reference external" href="https://coral.ai/docs/m2/get-started/#workaround-to-disable-apex-and-gasket">https://coral.ai/docs/m2/get-started/#workaround-to-disable-apex-and-gasket</a></p>
</div>
<section id="installez-le-pilote-pcie-et-les-packages-dexecution-edge-tpu">
<h3>22.4.1 Installez le pilote PCIe et les packages d’exécution Edge TPU<a class="headerlink" href="#installez-le-pilote-pcie-et-les-packages-dexecution-edge-tpu" title="Lien permanent vers cette rubrique"></a></h3>
<p>Tout d’abord, ajouter le dépôt de paquets Debian au système:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;deb https://packages.cloud.google.com/apt coral-edgetpu-stable main&quot;</span> <span class="o">|</span> <span class="n">sudo</span> <span class="n">tee</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apt</span><span class="o">/</span><span class="n">sources</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">coral</span><span class="o">-</span><span class="n">edgetpu</span><span class="o">.</span><span class="n">list</span>
<span class="n">sudo</span> <span class="n">curl</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">packages</span><span class="o">.</span><span class="n">cloud</span><span class="o">.</span><span class="n">google</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">apt</span><span class="o">/</span><span class="n">doc</span><span class="o">/</span><span class="n">apt</span><span class="o">-</span><span class="n">key</span><span class="o">.</span><span class="n">gpg</span> <span class="o">-</span><span class="n">o</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apt</span><span class="o">/</span><span class="n">trusted</span><span class="o">.</span><span class="n">gpg</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">coral</span><span class="o">.</span><span class="n">asc</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Installez ensuite le pilote PCIe et les packages d’exécution Edge TPU</strong></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">gasket</span><span class="o">-</span><span class="n">dkms</span> <span class="n">libedgetpu1</span><span class="o">-</span><span class="n">std</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>le compte utilisateur doit disposer des autorisations root</p>
</div>
<ul class="simple">
<li><p><strong>Une fois *redémarré*, vérifier que le module d’accélération est détecté:</strong></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lspci</span> <span class="o">-</span><span class="n">nn</span> <span class="o">|</span> <span class="n">grep</span> <span class="mi">089</span><span class="n">a</span>
</pre></div>
</div>
<p><a class="reference internal" href="../_images/image1607.webp"><img alt="image1607" src="../_images/image1607.webp" style="width: 605px;" /></a></p>
<ul class="simple">
<li><p><strong>Vérifiez également que le pilote PCIe est chargé :</strong></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ls</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">apex_0</span>
</pre></div>
</div>
<p><a class="reference internal" href="../_images/image1608.webp"><img alt="image1608" src="../_images/image1608.webp" style="width: 419px;" /></a></p>
</section>
</section>
<section id="nouvelles-configurations-de-docker-compose-et-config">
<h2>22.5 nouvelles configurations de docker-compose et config<a class="headerlink" href="#nouvelles-configurations-de-docker-compose-et-config" title="Lien permanent vers cette rubrique"></a></h2>
<section id="docker-compose-yml">
<h3>22.5.1 docker-compose.yml<a class="headerlink" href="#docker-compose-yml" title="Lien permanent vers cette rubrique"></a></h3>
<p><a class="reference internal" href="../_images/image1609.webp"><img alt="image1609" src="../_images/image1609.webp" style="width: 640px;" /></a></p>
</section>
<section id="config-config-yml">
<h3>22.5.1 config/config.yml<a class="headerlink" href="#config-config-yml" title="Lien permanent vers cette rubrique"></a></h3>
<ul class="simple">
<li><p>Ajouter ces lignes:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># N&#39;activez cette option que si vous utilisez les GPU Intel</span>
<span class="n">ffmpeg</span><span class="p">:</span>
  <span class="n">hwaccel_args</span><span class="p">:</span> <span class="n">preset</span><span class="o">-</span><span class="n">vaapi</span>
<span class="n">detectors</span><span class="p">:</span>
  <span class="n">coral</span><span class="p">:</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">edgetpu</span>
    <span class="n">device</span><span class="p">:</span> <span class="n">pci</span>
</pre></div>
</div>
</section>
</section>
<section id="installation-de-go2rtc">
<h2>22.5 installation de go2rtc<a class="headerlink" href="#installation-de-go2rtc" title="Lien permanent vers cette rubrique"></a></h2>
<p>ports RTSP et ONVIF pour caméras de marque : <a class="reference external" href="https://www.camapp365.com/technical/rtsp-and-onvif-ports">https://www.camapp365.com/technical/rtsp-and-onvif-ports</a></p>
<p><a class="reference external" href="https://github.com/AlexxIT/go2rtc">https://github.com/AlexxIT/go2rtc</a></p>
<ul class="simple">
<li><p><strong>création du répertoire /op/go2rtc</strong></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">go2rtc</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">go2rtc</span>
</pre></div>
</div>
<ul class="simple">
<li><p><a href="#id1"><span class="problematic" id="id2">**</span></a>création de docker-compose.yml</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">services</span><span class="p">:</span>
<span class="n">go2rtc</span><span class="p">:</span>
  <span class="n">image</span><span class="p">:</span> <span class="n">alexxit</span><span class="o">/</span><span class="n">go2rtc</span><span class="p">:</span><span class="n">master</span><span class="o">-</span><span class="n">hardware</span>
  <span class="n">network_mode</span><span class="p">:</span> <span class="n">host</span>       <span class="c1"># important for WebRTC, HomeKit, UDP cameras</span>
  <span class="n">privileged</span><span class="p">:</span> <span class="n">true</span>         <span class="c1"># only for FFmpeg hardware transcoding</span>
  <span class="n">restart</span><span class="p">:</span> <span class="n">unless</span><span class="o">-</span><span class="n">stopped</span>  <span class="c1"># autorestart on fail or config change from WebUI</span>
  <span class="n">environment</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">TZ</span><span class="o">=</span><span class="n">Europe</span><span class="o">/</span><span class="n">Paris</span>  <span class="c1"># timezone in logs</span>
  <span class="n">volumes</span><span class="p">:</span>
    <span class="o">-</span> <span class="s2">&quot;~/go2rtc:/config&quot;</span>   <span class="c1"># folder for go2rtc.yaml file (edit from WebUI)</span>
</pre></div>
</div>
<p><a class="reference internal" href="../_images/image1611.webp"><img alt="image1611" src="../_images/image1611.webp" style="width: 600px;" /></a></p>
<ul class="simple">
<li><p><strong>Démarrer le conteneur</strong></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
<p><a class="reference internal" href="../_images/image1612.webp"><img alt="image1612" src="../_images/image1612.webp" style="width: 605px;" /></a></p>
<p><a class="reference internal" href="../_images/image1613.webp"><img alt="image1613" src="../_images/image1613.webp" style="width: 492px;" /></a></p>
<p><a class="reference internal" href="../_images/image1614.webp"><img alt="image1614" src="../_images/image1614.webp" style="width: 605px;" /></a></p>
<ul class="simple">
<li><p><strong>config.yml:</strong></p></li>
</ul>
<p><a class="reference internal" href="../_images/image1615.webp"><img alt="image1615" src="../_images/image1615.webp" style="width: 632px;" /></a></p>
</section>
<section id="le-fichier-config-config-yml-avec-go2rtc">
<h2>22.6 le fichier config/config.yml avec go2rtc<a class="headerlink" href="#le-fichier-config-config-yml-avec-go2rtc" title="Lien permanent vers cette rubrique"></a></h2>
<p><a class="reference internal" href="../_images/image1616.webp"><img alt="image1616" src="../_images/image1616.webp" style="width: 700px;" /></a></p>
</section>
<section id="acces-distant">
<h2>22.7 Accès distant<a class="headerlink" href="#acces-distant" title="Lien permanent vers cette rubrique"></a></h2>
<ul class="simple">
<li><p><strong>Autoriser le port 5000</strong></p></li>
</ul>
<p><a class="reference internal" href="../_images/image1617.webp"><img alt="image1617" src="../_images/image1617.webp" style="width: 465px;" /></a></p>
<ul class="simple">
<li><p><strong>le fichier de configuration Nginx</strong></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#auth_basic &quot;Mot de Passe Obligatoire&quot;;
#auth_basic_user_file /etc/nginx/.htpasswd;
    server_name &lt;DOMAINE&gt;;

    location / {
     proxy_pass http://192.168.1.2:5000/;
     proxy_set_header Host $host;
     proxy_set_header X-Real-IP $remote_addr;
     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
 #WebSocket support
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection &quot;upgrade&quot;;
    proxy_http_version 1.1;
    }
    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/&lt;DOMAINE&gt;/fullchain.pem; #&gt;
    ssl_certificate_key /etc/letsencrypt/live/&lt;DOMAINE&gt;/privkey.pem;&gt;
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
}
server {
 if ($host = &lt;DOMAINE&gt;) {
     return 301 https://$host$request_uri;
 } # managed by Certbot
 listen      80 ;
 server_name &lt;DOMAINE&gt;;
 return 404; # managed by Certbot
</pre></div>
</div>
<p><em>voir cette exemple pour la configuration en http pour demander un certificat Let’sEncrypt</em>  <a class="reference internal" href="zigbee.html#acces-distant-https"><span class="std std-ref">9.4 accès distant HTTPS</span></a></p>
</section>
<section id="configuration-onvif-cameras-ptz">
<h2>22.8 Configuration onvif (caméras PTZ)<a class="headerlink" href="#configuration-onvif-cameras-ptz" title="Lien permanent vers cette rubrique"></a></h2>
<p><a class="reference internal" href="../_images/image1619.webp"><img alt="image1619" src="../_images/image1619.webp" style="width: 498px;" /></a></p>
<ul class="simple">
<li><p><strong>fichier /config/config.yml</strong></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ptz_nord</span><span class="p">:</span>
  <span class="n">ffmpeg</span><span class="p">:</span>
    <span class="n">inputs</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">path</span><span class="p">:</span> <span class="n">rtsp</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">8554</span><span class="o">/</span><span class="n">ptz_nord</span>
        <span class="n">input_args</span><span class="p">:</span> <span class="n">preset</span><span class="o">-</span><span class="n">rtsp</span><span class="o">-</span><span class="n">restream</span>
        <span class="n">roles</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">detect</span>
  <span class="n">onvif</span><span class="p">:</span>
    <span class="n">host</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span>
    <span class="n">port</span><span class="p">:</span> <span class="mi">8899</span>
    <span class="n">user</span><span class="p">:</span> <span class="n">admin</span>
    <span class="n">password</span><span class="p">:</span> <span class="s1">&#39;&#39;</span> <span class="c1"># si pas de password</span>
  <span class="n">detect</span><span class="p">:</span>
    <span class="n">enabled</span><span class="p">:</span> <span class="n">true</span>
</pre></div>
</div>
<ul class="simple">
<li><p>** fichier docker-compose.yml**</p></li>
</ul>
<p><a class="reference internal" href="../_images/image1620.webp"><img alt="image1620" src="../_images/image1620.webp" style="width: 454px;" /></a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ports ONVIF les plus utilisés: 80, 8000, 8080, 8899, 2000, 5000</p>
</div>
<p><a class="reference internal" href="../_images/image1621.webp"><img alt="image1621" src="../_images/image1621.webp" style="width: 550px;" /></a></p>
</section>
<section id="notifications-sans-homeassistant">
<h2>22.9 Notifications (sans HomeAssistant)<a class="headerlink" href="#notifications-sans-homeassistant" title="Lien permanent vers cette rubrique"></a></h2>
<p><a class="reference external" href="https://github.com/0x2142/frigate-notify/tree/main">https://github.com/0x2142/frigate-notify/tree/main</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pied de page">
        <a href="mon_installation.html" class="btn btn-neutral float-left" title="21. – Mon installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Précédent</a>
        <a href="optimisations.html" class="btn btn-neutral float-right" title="23. OPTIMISATION en cours" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Droits d'auteur 2024, Gravier.</p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>